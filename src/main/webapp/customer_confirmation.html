<!DOCTYPE html>
<html>
    <head>
        <style type="text/css">
            
            #bodyid{
                background:rgb(102, 255, 102);
            }

        </style>
        <title>Kaas Shop</title>
        <script src ="JS/jquery.js"></script>
        <script src ="JS/products.js"></script>
        <link href="CSS/simple.css" rel="stylesheet" />
    </head>

    <body id="bodyid">
        <h2 class="title">Confirmation</h2>
        <br/><br/><br/><br/>
        
        <form id="cartForm">
                <label><b>Welke Cart Wil je </b></label> <input id="IdId" type="text"
                                                         name="id" /><br /> 
</form>
                <button id="submitButton"> zet Cart </button>
        
      
        <button> <a href="customer_cart.html">Back to Cart</a></button>
         <button> <a href="index.html">Back to Home</a></button>
        
         

        <table id="table_main" class="display" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th align="left">Id</th>
                    <th align="left">SubOrderPrijs</th>   
                    <th align="left">Product</th>
                    <th align="left">Aantal</th>
                    <th align="left">ProductPrijs</th>
                </tr>
            </thead>
           <tfoot>
                 <th align="left" id="footer">TotaalPrijs: </th>
            </tfoot>
          </table> 
            
            <div id="details">
                <div id="first_name">Voornaam</div>
                <div id="last_name">AchterNaam</div>
                <div id="street">Street</div>
                <div id="number">Number</div>
                <div id="city">City</div>
                <div id="zip">Zip</div>
                <br/>
                <button><a  href="addresses.html">Verander Adres</a></button>
            </div>
       
       <button id='confirmation_button'>ECHTE BEVESTIGING</button>
        <script>
            var order_to_send;
            var id = 3;
            var totalPrijs = 0;
              $(document).ready(function () {
             
                 startCartInfoTable(id);
                 startSubOrderTable(id);
                });
           
            $("#submitButton").click(function(){
               
                id = $("#IdId").val();
               
                 startSubOrderTable(id);
                  startCartInfoTable(id);
                
            });
         
            $("#confirmation_button").click(function(){
                 id = $("#IdId").val();
                 
                 cartToOrder();
                  subOrderToFinalOrder(id);   
                 
                 
            });
            
        function cartToOrder(){
                
               id = $("#IdId").val();
                  
        cartsUrl = "rest/carts/" + id;
        cartSubOrderUrl = "rest/cartsuborders";
        
        $.getJSON(cartSubOrderUrl, function(cartSubOrders) {
            $.getJSON(cartsUrl, function(cart) {
                console.log(id);
                console.log(cart);
                
           var userId = cart.id;
           userUrl = "rest/users/" + id;
           
        $.getJSON(userUrl, function(User) {
            var subOrderList = [];
             $.each(cartSubOrders, function (key, value) {
                if (value.cart.id == userId){
                    subOrderList.push(value);
                }
            });
                 order_to_send ={ 
                        "city": cart.deliveryAddress.city,
                        "familyName": cart.deliveryAddress.familyName,
                        "firstName": cart.deliveryAddress.firstName,
                        "insertion": cart.deliveryAddress.insertion,
                        "numAddition": cart.deliveryAddress.numAddtion,
                        "number": cart.deliveryAddress.number,
                        "street": cart.deliveryAddress.street,
                        "totalPrice": totalPrijs,
                        "zipCode": cart.deliveryAddress.zipCode,
                        "finalSuborderList":subOrderList,
                        "user": User
                    };
                       
                    console.log(order_to_send);  
                        
                $.ajax({
                   type: "POST",
                   url: "rest/sales",
                   data: JSON.stringify(order_to_send),
                   contentType: "application/json",
                   success: function () {
                       console.log("order gelukt");
                      
                   },
                   error: function () {
                       console.log(jsonData);
                       console.log(" /n/n/n");
                       console.log(JSON.stringify(jsonData));
                   }
               });
            });   
        });
    });
}
            
            
            function subOrderToFinalOrder(id){
                
//                var userId;
//                cartUrl = "rest/carts";
//                $.getJSON(cartUrl, function(cart){
//                userId = cart.id;   
//            });
        
            cartSubOrderUrl = "rest/cartsuborders";
             productUrl = "rest/products";
        $.getJSON(cartSubOrderUrl, function(cartSubOrders) {     
             $.each(cartSubOrders, function (key, value) {
                if (value.cart.id == id){
                  console.log(order_to_send); 
                var jsonData ={ 
                        "itemPrice": value.product.price,
                        "prdBrand": value.product.brand,
                        "prdCategory": value.product.category,
                        "prdName": value.product.name,
                        "quantity": value.quantity,
                        "subTotal": value.subTotal,
                        "order": order_to_send 
                    }; 
                        
                $.ajax({
                   type: "POST",
                   url: "rest/finalsuborders",
                   data: JSON.stringify(jsonData),
                   contentType: "application/json",
                   success: function () {
                       console.log("finalsubOrder gelukt");
                       
                   },
                   error: function () {
                       console.log(jsonData);
                       console.log(" /n/n/n");
                       console.log(JSON.stringify(jsonData));
                    }
                    });
                }   
             });
            });
           }           
           
            function startCartInfoTable(id){
               $(".table_info_content").remove();  
             var datarow = " ";
             
                $.getJSON('rest/carts/'+ id, function (cartData) {
                        cartsData = cartData;
                        $("#first_name").html("Voornaam: " + cartData.deliveryAddress.firstName );
                        $("#last_name").html("Achternaam: " + cartData.deliveryAddress.familyName );
                        $("#street").html("Straat: " + cartData.deliveryAddress.street );
                        $("#number").html("Nummber: " + cartData.deliveryAddress.number + " " + cartData.deliveryAddress.numAddition  );
                        $("#city").html("Stad: " + cartData.deliveryAddress.city );
                        $("#zip").html("PostCode: " + cartData.deliveryAddress.zipCode );
                        
//                        datarow += ' <tr class="table_info_content">';
//                        //datarow += ' <td align=/"left/">' + cartData.userId.email + ' </td>';//
//                        datarow += ' <td align=/"left/">' + cartData.deliveryAddress.firstName + ' </td>';
//                        datarow += ' <td align=/"left/">' + cartData.deliveryAddress.familyName + ' </td>';
//                        datarow += ' <td align=/"left/">' + cartData.deliveryAddress.street + ' </td>';
//                        datarow += ' <td align=/"left/">' + cartData.deliveryAddress.number + ' </td>';
//                        datarow += ' <td align=/"left/">' + cartData.deliveryAddress.city + ' </td>';
//                        datarow += ' <td align=/"left/">' + cartData.deliveryAddress.zipCode + ' </td>';

                       // datarow += '</tr>';
                        
            $('#table_Cart_info').append(datarow) ;
                    });
 
               
        }
            function startSubOrderTable(id){
                
                $(".table_content").remove();

                 var datarowSubOrder = " ";
                
                $.getJSON('rest/cartsuborders', function (data) {
                   
                    
                    $.each(data, function (key, value) {
                        
                      
                      if (value.cart && value.cart.id==id  ){
                        datarowSubOrder += ' <tr class="table_content">';
                        datarowSubOrder += ' <td align=/"left/">' + value.id + ' </td>';
                        datarowSubOrder += ' <td align=/"left/">' + value.subTotal + ' </td>';
                        datarowSubOrder += ' <td align=/"left/">' + value.product.name + ' </td>';
                        datarowSubOrder += ' <td align=/"left/">' + value.quantity + ' </td>';
                        datarowSubOrder += ' <td align=/"left/">' + value.product.price + ' </td>';
                        
                        totalPrijs+= value.subTotal;
                       
                       }
                    });
                   
                    $('#table_main').append(datarowSubOrder);
                    $("#footer").text("TotaalPrijs: " + Math.round(totalPrijs*100)/100);
                    
                });
         
        }

        </script>
       
        

    </body>
</html>
